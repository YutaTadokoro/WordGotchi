# 要件定義書

## はじめに

WordGotchiは、ユーザーの感情をアートと詩に変換するAI搭載の仮想ペットアプリケーションです。ユーザーは散らばった言葉をクリックしてペットに餌を与え、その言葉は感情分析されます。ペットは段階を経て進化し、蓄積された感情を抽象的なアートと詩の生成を通じて表現し、インタラクティブな感情的コンパニオン体験を創出します。

## 用語集

- **WordGotchi**: 言葉を消費し感情を表現するAI仮想ペットシステム
- **Gotchi**: 仮想ペットキャラクターエンティティ
- **給餌セッション**: ユーザーがテキストを入力しGotchiに言葉を与える単一のインタラクション
- **感情ベクトル**: 7つの基本感情（喜び、悲しみ、怒り、恐れ、驚き、嫌悪、信頼）を0から1の値で数値表現したもの
- **進化段階**: Gotchiの独自の能力を持つ明確な発達段階
- **表現**: Gotchiが生成する出力で、抽象的なアートまたは詩のいずれか
- **感情減衰**: 時間経過に伴う感情強度の段階的な減少（1日あたり5%）
- **キャンバスエリア**: Gotchiとインタラクションがレンダリングされる上部表示領域
- **入力エリア**: テキスト入力とコントロールを含む下部表示領域

## 要件

### 要件1

**ユーザーストーリー:** ユーザーとして、テキストを入力して個々の言葉をペットに与えたい。そうすることで、自分の感情でペットを育てることに積極的に参加できる。

#### 受け入れ基準

1. ユーザーがテキスト入力を送信したとき、システムはテキストを個々の言葉に分解し、キャンバスエリア全体に散らばって表示しなければならない
2. ユーザーが散らばった言葉をクリックしたとき、システムはその言葉がGotchiキャラクターに向かって移動するアニメーションを実行しなければならない
3. 言葉がGotchiに到達したとき、システムは食べるアニメーションを再生し、表示から言葉を削除しなければならない
4. 給餌セッションのすべての言葉が消費されたとき、システムは感情固有のエモートアニメーションをトリガーしなければならない
5. 感情が喜びである場合、エモートがトリガーされたとき、Gotchiはジャンプアニメーションを実行しなければならない

### 要件2

**ユーザーストーリー:** ユーザーとして、ペットが自分の言葉の感情的内容を分析してほしい。そうすることで、ペットが自分の感情を理解し反映できる。

#### 受け入れ基準

1. 言葉がGotchiに与えられたとき、システムは感情分析のためにテキストをClaude APIに送信しなければならない
2. Claude APIが分析結果を返したとき、システムは7つの感情値（喜び、悲しみ、怒り、恐れ、驚き、嫌悪、信頼）を0から1の間の数値として抽出しなければならない
3. 感情値が抽出されたとき、システムは新しい値を蓄積することでGotchiの内部感情ベクトルを更新しなければならない
4. 時間が経過する間、システムはすべての感情値に1日あたり5%の割合で感情減衰を適用しなければならない
5. 感情ベクトルが更新されたとき、システムは新しい状態をlocalStorageに永続化しなければならない

### 要件3

**ユーザーストーリー:** ユーザーとして、ペットがその感情状態に基づいて抽象的なアートを生成してほしい。そうすることで、共有した感情を視覚化できる。

#### 受け入れ基準

1. 給餌セッションが完了し、かつGotchiがステージ2以上である場合、システムはプロキシサーバー経由でGoogle Gemini Imagen APIを使用して抽象的なアートを生成しなければならない
2. アートを生成する際、システムは感情ベクトルの支配的な感情に基づいてプロンプトを構築しなければならない
3. 支配的な感情が喜びである場合、プロンプトを構築する際、システムは金色と明るい色の仕様を含めなければならない
4. 支配的な感情が悲しみである場合、プロンプトを構築する際、システムは青と紫の深いトーンの仕様を含めなければならない
5. アート生成が完了したとき、システムはキャンバスエリアの中央にポップアップオーバーレイでアートワークを表示しなければならない
6. アートワークが表示されたとき、システムはユーザーにダウンロードと保存機能を提供しなければならない

### 要件4

**ユーザーストーリー:** ユーザーとして、ペットが自分の言葉から詩を生成してほしい。そうすることで、言葉にならない感情が詩的な形で表現されるのを見ることができる。

#### 受け入れ基準

1. 給餌セッションが完了し、かつGotchiがステージ2以上である場合、システムはプロキシサーバー経由でClaude APIを使用して詩を生成しなければならない
2. 詩を生成する際、システムはユーザーの入力テキストと現在の感情ベクトルをClaude APIに送信しなければならない
3. Claude APIが詩を生成したとき、システムは3行から5行の詩を受け取らなければならない
4. 詩が受信されたとき、システムはポップアップオーバーレイで詩を表示しなければならない
5. 詩が比喩と象徴を使用する場合、システムは直接的な感情描写を避けなければならない

### 要件5

**ユーザーストーリー:** ユーザーとして、ペットが異なる段階を経て進化してほしい。そうすることで、関係における成長と進歩を体験できる。

#### 受け入れ基準

1. アプリケーションが初めて初期化されたとき、システムはステージ1（Obake）のGotchiを作成しなければならない
2. Gotchiがステージ1である間、システムはキャラクターを明確な形のない透明な白い影としてレンダリングしなければならない
3. Gotchiがステージ1で10回の給餌セッションを完了したとき、システムはステージ2（Furin）への進化をトリガーしなければならない
4. 進化がトリガーされたとき、システムは画面全体の光効果と日本風のバックグラウンドミュージックを伴う特別な進化アニメーションを表示しなければならない
5. Gotchiがステージ2である間、システムは抽象的なアート生成と詩生成の機能を有効にしなければならない

### 要件6

**ユーザーストーリー:** ユーザーとして、ペットがアニメーション化されたキャンバスエリアに表示されるのを見たい。そうすることで、視覚的に魅力的な体験を楽しめる。

#### 受け入れ基準

1. アプリケーションが読み込まれたとき、システムは全幅にわたる400pxの高さのキャンバスエリアをレンダリングしなければならない
2. Gotchiが表示されている間、システムは浮遊動作でキャラクターをアニメーション化しなければならない
3. キャンバスエリアの背景をレンダリングする際、システムは深い紫（#0a0014）から黒へのグラデーションを適用しなければならない
4. Gotchiがアクティブな感情ベクトルを持つ場合、システムは支配的な感情に対応する色でキャラクターの周りにグロー効果をレンダリングしなければならない
5. 給餌中に言葉が散らばるとき、システムはキャンバスエリアの境界内にそれらを表示しなければならない

### 要件7

**ユーザーストーリー:** ユーザーとして、シンプルなインターフェースを通じてテキストを入力したい。そうすることで、複雑さなしに簡単にペットに餌を与えることができる。

#### 受け入れ基準

1. アプリケーションが読み込まれたとき、システムはキャンバスエリアの下に入力エリアを表示しなければならない
2. 入力エリアをレンダリングする際、システムは最大500文字の容量を持つテキスト入力フィールドを提供しなければならない
3. ユーザーが入力フィールドに入力する際、システムは残りの文字数を表示しなければならない
4. ユーザーが送信ボタンをクリックしたとき、システムは入力テキストで給餌セッションを開始しなければならない
5. ステータス情報を表示する際、システムは次の進化までの残りの給餌回数と現在の感情バランスを表示しなければならない

### 要件8

**ユーザーストーリー:** ユーザーとして、ペットのデータが自動的に保存されてほしい。そうすることで、ブラウザを閉じたときに進行状況を失わない。

#### 受け入れ基準

1. Gotchiの状態が変化したとき、システムは状態をJSON形式にシリアライズしてlocalStorageに保存しなければならない
2. Gotchiの状態を保存する際、システムは進化段階、感情ベクトル、パーソナリティデータを含めなければならない
3. 給餌セッションが完了したとき、システムは入力テキストと感情分析結果を含む給餌記録をlocalStorageに追加しなければならない
4. 給餌履歴を保存する際、システムは最大1000件の最近の記録を維持しなければならない
5. 表現作品を保存する際、システムは最大500件の最近生成されたアートワークと詩を維持しなければならない
6. localStorageデータが5MBを超えたとき、システムはサイズ制限を維持するために最も古い記録を自動的に削除しなければならない

### 要件9

**ユーザーストーリー:** ユーザーとして、ペットのデータをエクスポートおよびインポートしたい。そうすることで、別のブラウザやデバイスに転送できる。

#### 受け入れ基準

1. ユーザーがデータエクスポートを要求したとき、システムはlocalStorageからすべてのGotchiデータを取得し、ダウンロード可能なJSONファイルとしてフォーマットしなければならない
2. ユーザーがインポートファイルを提供したとき、システムはインポート前にJSON構造を検証しなければならない
3. インポート検証が成功したとき、システムは現在のlocalStorageデータをインポートされたデータで置き換えなければならない
4. インポート検証が失敗したとき、システムはエラーメッセージを表示し、現在の状態を維持しなければならない
5. データが正常にインポートされたとき、システムはインポートされたGotchiの状態を反映するためにアプリケーションをリロードしなければならない

### 要件10

**ユーザーストーリー:** ユーザーとして、インターフェース全体でスムーズで自然なアニメーションを見たい。そうすることで、体験が洗練され魅力的に感じられる。

#### 受け入れ基準

1. アニメーションが再生されるとき、システムは自然な動きを作成するためにイージング関数を適用しなければならない
2. 言葉がGotchiに向かって飛ぶとき、システムは有機的な動きのためにベジェ曲線の軌道を使用しなければならない
3. Gotchiがエモートを実行するとき、システムは2秒以内にアニメーションを完了しなければならない
4. ポップアップが表示または非表示になるとき、システムはフェードとスケールのトランジションを使用しなければならない
5. Gotchiが浮遊するとき、システムはスムーズな上下動作を作成するためにサイン波関数を使用しなければならない
